#!/bin/bash
source "$(dirname "${BASH_SOURCE[0]}")/../.env.local"

declare -a missing_env_vars
missing_env_vars=()

if [[ -z "$AUTH_FLASK_SECRET_KEY" ]]; then
  missing_env_vars+=(AUTH_FLASK_SECRET_KEY)
fi

if [[ -z "$AUTH0_CLIENT_ID" ]]; then
  missing_env_vars+=(AUTH0_CLIENT_ID)
fi

if [[ -z "$AUTH0_CLIENT_SECRET" ]]; then
  missing_env_vars+=(AUTH0_CLIENT_SECRET)
fi

if [[ ${#missing_env_vars[@]} -ne 0 ]]; then
  echo "Missing environment variables: ${missing_env_vars}"
  exit 1
fi

kubectl create secret generic auth-secret \
  --from-literal=auth_flask_secret_key="$AUTH_FLASK_SECRET_KEY" \
  --from-literal=auth0_client_id="$AUTH0_CLIENT_ID" \
  --from-literal=auth0_client_secret="$AUTH0_CLIENT_SECRET"
